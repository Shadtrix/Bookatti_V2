{% extends "basebs.html" %}

{% block title %}
Bookstore
{% endblock %}

{% block content %}
<!-- Chatbot Button -->
<button type="button" class="chatbot-button" data-bs-toggle="modal" data-bs-target="#chatbotModal">
    <i class="fas fa-comments"></i>
</button>

<!-- Modal -->
<div class="modal fade" id="chatbotModal" tabindex="-1" aria-labelledby="chatbotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chatbotModalLabel">Bookstore Chatbot</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <iframe id="chatbotIframe" src="http://localhost:5001/"
                        style="width: 100%; height: 500px; border: none;"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div id="cartIcon" class="cart-icon" onclick="toggleCart()">
        ðŸ›’
    </div>
    <div id="cart" class="cart hidden">
        <h2>Shopping Cart</h2>
        <ul id="cartItems"></ul>
        <div class="cart-total">
            <p>Total: <span id="cartTotal">$0.00</span></p>
        </div>
    </div>
    <div class="filters">
        <button onclick="filterBooks('all')">All</button>
        <button onclick="filterBooks('fiction')">Fiction</button>
        <button onclick="filterBooks('non-fiction')">Non-Fiction</button>
        <button onclick="filterBooks('fantasy-sci-fi')">Fantasy/Sci-fi</button>
        <button onclick="filterBooks('mystery-thriller')">Mystery/Thriller</button>
    </div>

    <div class="book-grid">
        <!-- Fiction -->
        <div class="book fiction"
             onclick="showDetails('To Kill a Mockingbird', 'Harper Lee', '978-0061120084', '$10.99', 'A novel about the moral growth of a young girl in the racially charged South.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780061120084-L.jpg" alt="To Kill a Mockingbird">
            <h3>To Kill a Mockingbird</h3>
            <p>Harper Lee</p>
            <p>ISBN: 978-0061120084</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('1984', 'George Orwell', '978-0451524935', '$9.99', 'A dystopian novel about a totalitarian regime that uses surveillance to control its citizens.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780451524935-L.jpg" alt="1984">
            <h3>1984</h3>
            <p>George Orwell</p>
            <p>ISBN: 978-0451524935</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('Pride and Prejudice', 'Jane Austen', '978-1503290563', '$8.49', 'A classic novel about love and misunderstandings in 19th century England.')">
            <img src="https://covers.openlibrary.org/b/isbn/9781503290563-L.jpg" alt="Pride and Prejudice">
            <h3>Pride and Prejudice</h3>
            <p>Jane Austen</p>
            <p>ISBN: 978-1503290563</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('The Alchemist', 'Paulo Coelho', '978-0061122415', '$12.99', 'A philosophical journey of self-discovery.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780061122415-L.jpg" alt="The Alchemist">
            <h3>The Alchemist</h3>
            <p>Paulo Coelho</p>
            <p>ISBN: 978-0061122415</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('Jane Eyre', 'Charlotte BrontÃ«', '978-0141441146', '$9.49', 'A novel about a young womanâ€™s journey to independence.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780141441146-L.jpg" alt="Jane Eyre">
            <h3>Jane Eyre</h3>
            <p>Charlotte BrontÃ«</p>
            <p>ISBN: 978-0141441146</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('Wuthering Heights', 'Emily BrontÃ«', '978-0141439556', '$9.99', 'A gothic tale of love and revenge.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780141439556-L.jpg" alt="Wuthering Heights">
            <h3>Wuthering Heights</h3>
            <p>Emily BrontÃ«</p>
            <p>ISBN: 978-0141439556</p>
        </div>
        <div class="book fiction"
             onclick="showDetails('Brave New World', 'Aldous Huxley', '978-0060850524', '$11.49', 'A dystopian vision of the future.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780060850524-L.jpg" alt="Brave New World">
            <h3>Brave New World</h3>
            <p>Aldous Huxley</p>
            <p>ISBN: 978-0060850524</p>
        </div>

        <!-- Non-fiction -->
        <div class="book non-fiction"
             onclick="showDetails('Sapiens', 'Yuval Noah Harari', '978-0062316097', '$15.99', 'An exploration of the history of humankind.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780062316097-L.jpg" alt="Sapiens">
            <h3>Sapiens</h3>
            <p>Yuval Noah Harari</p>
            <p>ISBN: 978-0062316097</p>
        </div>
        <div class="book non-fiction"
             onclick="showDetails('Atomic Habits', 'James Clear', '978-0735211292', '$11.99', 'A guide to building good habits and breaking bad ones.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780735211292-L.jpg" alt="Atomic Habits">
            <h3>Atomic Habits</h3>
            <p>James Clear</p>
            <p>ISBN: 978-0735211292</p>
        </div>
        <div class="book non-fiction"
             onclick="showDetails('Becoming', 'Michelle Obama', '978-1524763138', '$13.99', 'A memoir by the former First Lady.')">
            <img src="https://covers.openlibrary.org/b/isbn/9781524763138-L.jpg" alt="Becoming">
            <h3>Becoming</h3>
            <p>Michelle Obama</p>
            <p>ISBN: 978-1524763138</p>
        </div>

        <!-- Fantasy/Sci-fi -->
        <div class="book fantasy-sci-fi"
             onclick="showDetails('The Hobbit', 'J.R.R. Tolkien', '978-0547928227', '$10.99', 'The epic journey of Bilbo Baggins.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780547928227-L.jpg" alt="The Hobbit">
            <h3>The Hobbit</h3>
            <p>J.R.R. Tolkien</p>
            <p>ISBN: 978-0547928227</p>
        </div>
        <div class="book fantasy-sci-fi"
             onclick="showDetails('Dune', 'Frank Herbert', '978-0441013593', '$13.99', 'A science fiction masterpiece set on the desert planet Arrakis.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780441013593-L.jpg" alt="Dune">
            <h3>Dune</h3>
            <p>Frank Herbert</p>
            <p>ISBN: 978-0441013593</p>
        </div>
        <div class="book fantasy-sci-fi"
             onclick="showDetails('The Name of the Wind', 'Patrick Rothfuss', '978-0756404741', '$14.99', 'A story of a gifted young manâ€™s rise to legend.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780756404741-L.jpg" alt="The Name of the Wind">
            <h3>The Name of the Wind</h3>
            <p>Patrick Rothfuss</p>
            <p>ISBN: 978-0756404741</p>
        </div>

        <!-- Mystery/Thriller -->
        <div class="book mystery-thriller"
             onclick="showDetails('Gone Girl', 'Gillian Flynn', '978-0307588371', '$12.49', 'A thriller about a missing wife and a husband under suspicion.')">
            <img src="https://covers.openlibrary.org/b/isbn/9780307588371-L.jpg" alt="Gone Girl">
            <h3>Gone Girl</h3>
            <p>Gillian Flynn</p>
            <p>ISBN: 978-0307588371</p>
        </div>
        <div class="book mystery-thriller"
             onclick="showDetails('The Silent Patient', 'Alex Michaelides', '978-1250301697', '$13.49', 'A psychological thriller about a woman who stops speaking after a crime.')">
            <img src="https://covers.openlibrary.org/b/isbn/9781250301697-L.jpg" alt="The Silent Patient">
            <h3>The Silent Patient</h3>
            <p>Alex Michaelides</p>
            <p>ISBN: 978-1250301697</p>
        </div>
    </div>

    <div id="bookDetailsModal" class="book-modal">
        <div class="book-modal-content">
            <span class="book-modal-close" onclick="closeModal()">&times;</span>
            <h3 id="bookTitle"></h3>
            <p id="bookAuthor"></p>
            <p>ISBN: <span id="bookISBN"></span></p>
            <p id="bookPrice"></p>
            <p id="bookDescription" class="book-description"></p>
            <div class="quantity-selector">
                <button id="decreaseQuantity" class="quantity-btn" onclick="updateQuantity(-1)">-</button>
                <span id="quantity">1</span>
                <button id="increaseQuantity" class="quantity-btn" onclick="updateQuantity(1)">+</button>
            </div>
            <button id="addToCartButton" class="add-to-cart">Add to Cart</button>
        </div>
    </div>

</div>

<style>
    .container {
        position: relative;
    }

.cart {
    position: fixed;
    top: 80px;
    right: 20px;
    background: #fff;
    border: 1px solid #ddd;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    width: 350px;
    max-height: 500px;
    overflow-y: auto;
    z-index: 1000;
    font-family: Arial, sans-serif;
}

.cart h2 {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #333;
    text-align: center;
    border-bottom: 2px solid #ddd;
    padding-bottom: 10px;
}

.cart ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #f1f1f1;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.cart-item .item-details {
    flex-grow: 1;
    margin-right: 10px;
}

.cart-item .item-details h4 {
    font-size: 14px;
    margin: 0;
    color: #333;
}

.cart-item .item-details p {
    font-size: 12px;
    margin: 5px 0;
    color: #555;
}

.cart-item .item-actions {
    display: flex;
    align-items: center;
    gap: 5px;
}

.cart-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 5px 8px;
    cursor: pointer;
    font-size: 12px;
    transition: background-color 0.3s ease;
}

.cart-button:hover {
    background-color: #0056b3;
}

.delete-btn {
    background-color: #dc3545;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 5px 8px;
    cursor: pointer;
    font-size: 12px;
    transition: background-color 0.3s ease;
}

.delete-btn:hover {
    background-color: #a71d2a;
}

.cart-total {
    border-top: 2px solid #ddd;
    padding-top: 10px;
    margin-top: 10px;
    text-align: right;
}

.cart-total p {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin: 0;
}
.cart.hidden {
    display: none;
}

.cart-icon {
    position: absolute; /* Use absolute positioning */
    top: 5px; /* Adjust this value to place it below the navbar */
    right: 30px; /* Keep it aligned to the right */
    background: #fff; /* White background for better visibility */
    border: 1px solid #ddd;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    font-size: 24px;
    z-index: 1001; /* Ensure it appears above other elements */
}

    .quantity-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 20px 0; /* Add some spacing */
}

.quantity-btn {
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.quantity-btn:hover {
    background-color: #0056b3; /* Darker color on hover */
}

#quantity {
    font-size: 18px;
    margin: 0 10px;
    width: 40px;
    text-align: center;
}

.book-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(175px, 1fr)); /* Increase min width to 250px */
    gap: 10px;
    padding: 10px;
}

.book {
    text-align: center;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 5px;
    background-color: #f9f9f9;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    width: 100%; /* Allow full width within the grid */
}


    .book img {
        max-width: 100px;
        margin-bottom: 5px;
    }

    .book:hover {
        transform: translateY(-3px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }




@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}
.book-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6); /* Add a darker semi-transparent background */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000; /* Ensure it appears above all elements */
    display: none; /* Initially hidden */
}

.book-modal-content {
    background: #fff; /* White background for contrast */
    padding: 30px; /* Add generous padding for spacing */
    border-radius: 10px; /* Rounded corners for a modern look */
    width: 90%; /* Responsive width */
    max-width: 600px; /* Limit maximum width */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* Add a shadow for depth */
    text-align: left; /* Left-align for better readability */
    position: relative; /* For the close button */
    animation: fadeIn 0.3s ease; /* Smooth fade-in animation */
}

.book-modal-content h3 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #333; /* Darker text color for strong visibility */
}

.book-modal-content p {
    margin: 10px 0;
    font-size: 16px;
    color: #555; /* Subtle text color for descriptions */
    line-height: 1.5; /* Improve text readability */
}

.book-modal-content .book-description {
    font-style: italic;
    color: #666;
}

.book-modal-content #addToCartButton {
    display: block; /* Full-width button */
    width: 100%; /* Make the button span the full width of the modal content */
    margin-top: 20px;
    padding: 10px 20px; /* Adjust padding for a more prominent button */
    font-size: 16px;
    color: #fff;
    background-color: #007bff; /* Primary color for button */
    border: none;
    border-radius: 5px; /* Slightly rounded corners for modern design */
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth hover effects */
}

.book-modal-content #addToCartButton:hover {
    background-color: #0056b3; /* Darker blue on hover */
    transform: translateY(-2px); /* Subtle lifting effect */
}


.book-modal-content .book-modal-close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 24px;
    color: #333;
    cursor: pointer;
    background: none;
    border: none;
    outline: none;
    transition: color 0.3s ease; /* Smooth color change on hover */
}

.book-modal-content .book-modal-close:hover {
    color: #000; /* Slightly darker on hover */
}

</style>
<script>
    let cart = []; // Array to store cart items
    let total = 0; // Total price
    let quantity = 1;

    function filterBooks(category) {
        const books = document.querySelectorAll('.book');
        books.forEach(book => {
            book.style.display = category === 'all' || book.classList.contains(category) ? 'block' : 'none';
        });
    }

    function showDetails(title, author, isbn, price, description) {
        document.getElementById('bookTitle').textContent = title;
        document.getElementById('bookAuthor').textContent = `Author: ${author}`;
        document.getElementById('bookISBN').textContent = isbn;
        document.getElementById('bookPrice').textContent = `Price: ${price}`;
        document.getElementById('bookDescription').textContent = description;
        document.getElementById('quantity').textContent = 1; // Reset quantity display
        quantity = 1; // Reset quantity variable
        document.getElementById('addToCartButton').onclick = () => addToCart(title, author, price, quantity);
        document.getElementById('bookDetailsModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('bookDetailsModal').style.display = 'none';
    }

    function updateQuantity(change) {
        quantity = Math.max(1, quantity + change); // Prevent quantity from going below 1
        document.getElementById('quantity').textContent = quantity; // Update quantity display
    }

function addToCart(title, author, price, quantity) {
    const itemPrice = parseFloat(price.substring(1)); // Extract numeric price from string
    const existingItem = cart.find(item => item.title === title);

    if (existingItem) {
        // Update quantity and total price for existing item
        existingItem.quantity += quantity;
        existingItem.totalPrice += itemPrice * quantity;
    } else {
        // Add new item to the cart
        cart.push({
            title,
            author,
            price: `$${itemPrice.toFixed(2)}`,
            quantity,
            totalPrice: itemPrice * quantity
        });
    }

    total += itemPrice * quantity; // Update total price
    updateCart();
    closeModal();
}

function updateCart() {
    const cartItems = document.getElementById('cartItems');
    cartItems.innerHTML = ''; // Clear current cart items

    cart.forEach((item, index) => {
        // Create cart item container
        const li = document.createElement('li');
        li.classList.add('cart-item');

        // Create item details section
        const itemDetails = document.createElement('div');
        itemDetails.classList.add('item-details');
        itemDetails.innerHTML = `
            <h4>${item.title} by ${item.author}</h4>
            <p>${item.quantity > 1 ? `$${(item.totalPrice / item.quantity).toFixed(2)} (x${item.quantity}) - $${item.totalPrice.toFixed(2)}` : `$${item.totalPrice.toFixed(2)} (x${item.quantity})`}</p>
        `;

        // Create action buttons
        const itemActions = document.createElement('div');
        itemActions.classList.add('item-actions');

        const decreaseButton = document.createElement('button');
        decreaseButton.textContent = '-';
        decreaseButton.classList.add('cart-button');
        decreaseButton.onclick = () => updateCartItemQuantity(index, -1);

        const increaseButton = document.createElement('button');
        increaseButton.textContent = '+';
        increaseButton.classList.add('cart-button');
        increaseButton.onclick = () => updateCartItemQuantity(index, 1);

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.classList.add('delete-btn');
        deleteButton.onclick = () => deleteFromCart(index);

        itemActions.appendChild(decreaseButton);
        itemActions.appendChild(increaseButton);
        itemActions.appendChild(deleteButton);

        li.appendChild(itemDetails);
        li.appendChild(itemActions);

        cartItems.appendChild(li);
    });

    document.getElementById('cartTotal').textContent = `$${total.toFixed(2)}`; // Update total price display
}


    function updateCartItemQuantity(index, change) {
        const item = cart[index];
        const itemPricePerUnit = item.totalPrice / item.quantity; // Calculate price per unit

        item.quantity += change;
        if (item.quantity < 1) {
            deleteFromCart(index); // Remove item if quantity goes below 1
        } else {
            item.totalPrice = item.quantity * itemPricePerUnit; // Update total price for the item
            total += change * itemPricePerUnit; // Update total price
            updateCart(); // Refresh the cart display
        }
    }

    function deleteFromCart(index) {
        const item = cart[index];
        total -= item.totalPrice; // Deduct the item's total price from total
        cart.splice(index, 1); // Remove the item from the cart array
        updateCart(); // Refresh the cart display
    }

    function toggleCart() {
        const cartElement = document.getElementById('cart');
        cartElement.classList.toggle('hidden');
        cartElement.style.display = cartElement.classList.contains('hidden') ? 'none' : 'block';
    }
</script>
{% endblock %}
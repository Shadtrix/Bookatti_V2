<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Chatbot</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <style>
        /* Custom style to remove bullets */
        .no-bullets {
            list-style-type: none;
            padding-left: 0;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Library Chatbot</h1>
    <div class="card">
        <div class="card-body">
            <!-- Chatbox with initial prompts -->
            <div id="chat-box" class="mb-3" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                <div>
                    <strong>Bookatti:</strong> How may I help you? Here are some things you can ask me:
                    <ul class="no-bullets">
                        {% for prompt in suggested_prompts %}
                            <li>{{ prompt }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <!-- Chat Input Form -->
            <form id="chat-form">
                <div class="input-group">
                    <input type="text" class="form-control" id="user-input" placeholder="Type your message here..." required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById("chat-form");
    const inputField = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");

    // Function to handle form submission
    async function handleFormSubmit(event) {
        event.preventDefault(); // Prevent default form submission

        const userInput = inputField.value.trim();
        if (!userInput) return; // Ignore empty input

        // Display user message
        chatBox.innerHTML += `<div><strong>You:</strong> ${userInput}</div>`;
        inputField.value = ""; // Clear input field

        // Send input to the backend
        const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `user_input=${encodeURIComponent(userInput)}`
        });

        const data = await response.json();

        // Display chatbot response
        let botResponse = `<div><strong>Bookatti:</strong> ${data.response}</div>`;

        // If suggested prompts are returned, display them as a clean list
        if (data.suggested_prompts) {
            const promptList = data.suggested_prompts.map(prompt => `<div>${prompt}</div>`).join("");
            botResponse += `<div>${promptList}</div>`;
        }

        chatBox.innerHTML += botResponse;
        chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the bottom
    }

    // Event listeners for submission and Enter key
    form.addEventListener("submit", handleFormSubmit);
    inputField.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            form.dispatchEvent(new Event("submit"));
        }
    });
</script>
</body>
</html>
